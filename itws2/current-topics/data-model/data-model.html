<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>Data Model for User Directory Application</title>
<!-- 2020-12-12 Sat 19:19 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="VLEAD" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center; }
  .todo   { font-family: monospace; color: red; }
  .done   { color: green; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.right  { text-align: center;  }
  th.left   { text-align: center;   }
  th.center { text-align: center; }
  td.right  { text-align: right;  }
  td.left   { text-align: left;   }
  td.center { text-align: center; }
  dt { font-weight: bold; }
  .footpara:nth-child(2) { display: inline; }
  .footpara { display: block; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="../../style/css/worg-style.css" />
<link rel="stylesheet" type="text/css" href="../../style/css/override.css" />
<link rel="icon" type="image/png" href="../../style/img/favicon/popl.png" />
<script type="text/javascript" src="../../style/js/org-info.js">
/**
 *
 * @source: ../../style/js/org-info.js
 *
 * @licstart  The following is the entire license notice for the
 *  JavaScript code in ../../style/js/org-info.js.
 *
 * Copyright (C) 2012-2013 Free Software Foundation, Inc.
 *
 *
 * The JavaScript code in this tag is free software: you can
 * redistribute it and/or modify it under the terms of the GNU
 * General Public License (GNU GPL) as published by the Free Software
 * Foundation, either version 3 of the License, or (at your option)
 * any later version.  The code is distributed WITHOUT ANY WARRANTY;
 * without even the implied warranty of MERCHANTABILITY or FITNESS
 * FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.
 *
 * As additional permission under GNU GPL version 3 section 7, you
 * may distribute non-source (e.g., minimized or compacted) forms of
 * that code without the copy of the GNU GPL normally required by
 * section 4, provided you include this license notice and a URL
 * through which recipients can access the Corresponding Source.
 *
 * @licend  The above is the entire license notice
 * for the JavaScript code in ../../style/js/org-info.js.
 *
 */
</script>

<script type="text/javascript">

/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/

<!--/*--><![CDATA[/*><!--*/
org_html_manager.set("TOC_DEPTH", "1");
org_html_manager.set("LINK_HOME", "../../index.html");
org_html_manager.set("LINK_UP", "../index.html");
org_html_manager.set("LOCAL_TOC", "1");
org_html_manager.set("VIEW_BUTTONS", "0");
org_html_manager.set("MOUSE_HINT", "underline");
org_html_manager.set("FIXED_TOC", "0");
org_html_manager.set("TOC", "1");
org_html_manager.set("VIEW", "info");
org_html_manager.setup();  // activate after the parameters are set
/*]]>*///-->
</script>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href="../index.html"> UP </a>
 |
 <a accesskey="H" href="../../index.html"> HOME </a>
</div><div id="content">
<h1 class="title">Data Model for User Directory Application</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. Introduction</a></li>
<li><a href="#sec-2">2. Notation</a>
<ul>
<li><a href="#sec-2-1">2.1. Sets, cardinality and relations</a></li>
<li><a href="#sec-2-2">2.2. Relations and their cardinality type</a></li>
<li><a href="#sec-2-3">2.3. Example of Entity Relationship notation</a></li>
</ul>
</li>
<li><a href="#sec-3">3. Abstract Entity Types</a>
<ul>
<li><a href="#entity_user">3.1. User</a></li>
<li><a href="#entity_email">3.2. Email</a></li>
<li><a href="#entity_name">3.3. Name</a></li>
<li><a href="#entity_role">3.4. Role</a></li>
<li><a href="#entity_session">3.5. Session</a></li>
</ul>
</li>
<li><a href="#cardinal_constraints">4. Relations and cardinality constraints over entity types</a></li>
<li><a href="#sec-5">5. Keys</a></li>
<li><a href="#sec-6">6. System state</a>
<ul>
<li><a href="#user_session_sets">6.1. Primary Entity sets</a></li>
<li><a href="#sec-6-2">6.2. Applying relations to sets</a></li>
<li><a href="#sec-6-3">6.3. Derived Entity sets</a></li>
<li><a href="#sec-6-4">6.4. Referential Integrity Constraints over entity-sets</a>
<ul>
<li><a href="#admin_user">6.4.1. Admin User</a></li>
<li><a href="#referential_constraints">6.4.2. Referential Integrity over primary and derived entity sets</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-7">7. Operations</a>
<ul>
<li><a href="#sec-7-1">7.1. Actor</a>
<ul>
<li><a href="#sec-7-1-1">7.1.1. Authorize a user for Login</a></li>
<li><a href="#sec-7-1-2">7.1.2. Associate a role to a login session</a></li>
<li><a href="#sec-7-1-3">7.1.3. Logout</a></li>
<li><a href="#sec-7-1-4">7.1.4. Add User</a></li>
<li><a href="#sec-7-1-5">7.1.5. Show Users</a></li>
<li><a href="#sec-7-1-6">7.1.6. Show User Details</a></li>
<li><a href="#sec-7-1-7">7.1.7. Set Name of a User</a></li>
<li><a href="#sec-7-1-8">7.1.8. Set Email of a User</a></li>
<li><a href="#sec-7-1-9">7.1.9. Get User by Email</a></li>
<li><a href="#sec-7-1-10">7.1.10. Delete User</a></li>
<li><a href="#sec-7-1-11">7.1.11. Get Role set in the system.</a></li>
<li><a href="#sec-7-1-12">7.1.12. Get Roles of a User</a></li>
<li><a href="#sec-7-1-13">7.1.13. Add Role</a></li>
<li><a href="#sec-7-1-14">7.1.14. Delete Role</a></li>
<li><a href="#sec-7-1-15">7.1.15. Show Sessions</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Introduction</h2>
<div class="outline-text-2" id="text-1">
<p>
The application or the system is abstracted as the data model.  The model
captures: the entities that comprise the system; relations and constraints
between these entities; and operations that entail a change in the state of
the system.
</p>
</div>
</div>


<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> Notation</h2>
<div class="outline-text-2" id="text-2">
<p>
The system is defined as the data model.  There is a certain notation that is
used defining the data model. 
</p>
</div>

<div id="outline-container-sec-2-1" class="outline-3">
<h3 id="sec-2-1"><span class="section-number-3">2.1</span> Sets, cardinality and relations</h3>
<div class="outline-text-3" id="text-2-1">
<p>
If <code>A</code> is a set, then
</p>
<ol class="org-ol">
<li><code>A!</code> denotes exactly one element of <code>A</code>.
</li>
<li><code>A?</code> denotes at most one element of <code>A</code>.
</li>
<li><code>A+</code> denotes  one or more elements of <code>A</code>
</li>
<li><code>A*</code>  denotes at zero or more elements of <code>A</code>.  Often
abbreviated as <code>A</code>.
</li>
<li><code>A &gt; B</code> denotes a relation <i>from</i> <code>A</code> <i>to</i> <code>B</code>.
</li>
</ol>
</div>
</div>

<div id="outline-container-sec-2-2" class="outline-3">
<h3 id="sec-2-2"><span class="section-number-3">2.2</span> Relations and their cardinality type</h3>
<div class="outline-text-3" id="text-2-2">
<p>
A relation <code>r:A &gt; B</code> could relate each element of <code>A</code> to
zero, one or more elements of <code>B</code>.
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="left">Cardinality of B</th>
<th scope="col" class="left">Notation</th>
<th scope="col" class="left">&#xa0;</th>
<th scope="col" class="left">&#xa0;</th>
</tr>
</thead>
<tbody>
<tr>
<td class="left">at least zero elements of <code>B</code>.</td>
<td class="left">r: A &gt; B</td>
<td class="left">&#xa0;</td>
<td class="left">&#xa0;</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="left">at most one element of <code>B</code></td>
<td class="left">r: A &gt; B?</td>
<td class="left">&#xa0;</td>
<td class="left">&#xa0;</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="left">at least one element of <code>B</code></td>
<td class="left">r: A &gt; B+</td>
<td class="left">&#xa0;</td>
<td class="left">&#xa0;</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="left">exactly one element of <code>B</code></td>
<td class="left">r: A &gt; B!</td>
<td class="left">&#xa0;</td>
<td class="left">&#xa0;</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-sec-2-3" class="outline-3">
<h3 id="sec-2-3"><span class="section-number-3">2.3</span> Example of Entity Relationship notation</h3>
<div class="outline-text-3" id="text-2-3">
<p>
This example gives a formal representation of the requirement <a href="./requirements.html#req_user_uniqueness">user uniqueness</a>.
</p>
<pre class="example">
 [email, user] : User? &gt; Email!
</pre>

<p>
Encodes the following items of information:
</p>

<ul class="org-ul">
<li><code>email</code> is a relation <i>from</i> the set <code>User</code> <i>to</i> the set
<code>Email</code>.
</li>

<li><code>User</code> is called the <i>domain</i> of the relation <code>email</code>.
</li>

<li><code>Email</code> is called the <i>codomain</i> of the relation <code>email</code>.
</li>

<li>The relation <code>email</code> relates each element of <code>User</code> to
<i>exactly one</i> element of <code>Email</code>.  This is written as 
</li>
</ul>

<pre class="example">
email: User &gt; Email!
</pre>

<ul class="org-ul">
<li><code>user</code> is a relation <i>from</i> the set <code>Email</code> <i>to</i> the set
<code>User</code>.
</li>

<li><code>Email</code> is called the <i>domain</i> of the relation <code>user</code>.
</li>

<li><code>User</code> is called the <i>codomain</i> of the relation <code>user</code>.
</li>

<li>The relation <code>user</code> relates each element of <code>Email</code> to
<i>at most one</i> element of <code>User</code>.  This is written as 
</li>
</ul>

<pre class="example">
user: Email &gt; User?
</pre>
</div>
</div>
</div>


<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> Abstract Entity Types</h2>
<div class="outline-text-2" id="text-3">
<p>
The following are the abstract data types in our system. 
</p>
</div>
<div id="outline-container-entity_user" class="outline-3">
<h3 id="entity_user"><a id="sec-3-1" name="sec-3-1"></a><span class="section-number-3">3.1</span> User</h3>
<div class="outline-text-3" id="text-entity_user">
<p>
Requirement satisfied: <a href="./requirements.html#req_user">User</a>
</p>

<div class="org-src-container">

<pre class="src src-spec">;;; Entity Types
TYPE User
</pre>
</div>
</div>
</div>

<div id="outline-container-entity_email" class="outline-3">
<h3 id="entity_email"><a id="sec-3-2" name="sec-3-2"></a><span class="section-number-3">3.2</span> Email</h3>
<div class="outline-text-3" id="text-entity_email">
<p>
Requirement satisfied: <a href="./requirements.html#req_user_identification">Email</a>
</p>
<div class="org-src-container">

<pre class="src src-spec">TYPE Email
</pre>
</div>
</div>
</div>

<div id="outline-container-entity_name" class="outline-3">
<h3 id="entity_name"><a id="sec-3-3" name="sec-3-3"></a><span class="section-number-3">3.3</span> Name</h3>
<div class="outline-text-3" id="text-entity_name">
<p>
Requirement satisfied: <a href="./requirements.html#req_user_name">Name</a>
</p>
<div class="org-src-container">

<pre class="src src-spec">TYPE Name
</pre>
</div>
</div>
</div>

<div id="outline-container-entity_role" class="outline-3">
<h3 id="entity_role"><a id="sec-3-4" name="sec-3-4"></a><span class="section-number-3">3.4</span> Role</h3>
<div class="outline-text-3" id="text-entity_role">
<p>
Requirement satisfied: <a href="./requirements.html#req_role">Role</a>
</p>
<div class="org-src-container">

<pre class="src src-spec">TYPE Role = {admin, user}
</pre>
</div>
</div>
</div>

<div id="outline-container-entity_session" class="outline-3">
<h3 id="entity_session"><a id="sec-3-5" name="sec-3-5"></a><span class="section-number-3">3.5</span> Session</h3>
<div class="outline-text-3" id="text-entity_session">
<p>
Requirement satisfied: <a href="./requirements.html#req_session">Session</a>
</p>
<div class="org-src-container">

<pre class="src src-spec">TYPE Session
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-cardinal_constraints" class="outline-2">
<h2 id="cardinal_constraints"><a id="sec-4" name="sec-4"></a><span class="section-number-2">4</span> Relations and cardinality constraints over entity types</h2>
<div class="outline-text-2" id="text-cardinal_constraints">
<p>
For each relation, we define its inverse next to it.
</p>

<p>
Meets requirements <a href="./requirements.html#req_user_uniqueness">uniqueness of a user</a>, <a href="./requirements.html#req_user_role">role of a user</a> and <a href="./requirements.html#req_session_constraints">session constraints</a>
</p>

<div class="org-src-container">

<pre class="src src-spec">;;; Relations with cardinality constraints
[email, user]    :  User?    &gt; Email!
[name, users]    :  User     &gt; Name!
[roles, users]   :  User     &gt; Role+
[user, sessions] :  Session  &gt; User!
</pre>
</div>


<p>   The following diagram summarizes all the cardinality constraints
across all entities.
</p>
<img src="https://docs.google.com/drawings/d/1960E6vwRV9OqUOaUfyOU07btK4hQJLSyZwy1TOPeOF4/pub?w=960&h=720"
<p align="center"> Entity Diagram </p>

<p>
To edit the image click <a href="https://docs.google.com/drawings/d/1960E6vwRV9OqUOaUfyOU07btK4hQJLSyZwy1TOPeOF4/edit?usp=sharing">here</a>.
</p>
</div>
</div>


<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5"><span class="section-number-2">5</span> Keys</h2>
<div class="outline-text-2" id="text-5">
<p>
An entity <code>K</code> is called a <i>key for</i> an entity <code>A</code> if there
is a relation <code>r: A? &gt; K!</code>.
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />

<col  class="left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="left">Entity</th>
<th scope="col" class="left">Key</th>
</tr>
</thead>
<tbody>
<tr>
<td class="left">User</td>
<td class="left">Email</td>
</tr>
</tbody>
</table>
</div>
</div>


<div id="outline-container-sec-6" class="outline-2">
<h2 id="sec-6"><span class="section-number-2">6</span> System state</h2>
<div class="outline-text-2" id="text-6">
<p>
The system's state is captured by a set of <i>state variables</i>.
</p>
</div>

<div id="outline-container-user_session_sets" class="outline-3">
<h3 id="user_session_sets"><a id="sec-6-1" name="sec-6-1"></a><span class="section-number-3">6.1</span> Primary Entity sets</h3>
<div class="outline-text-3" id="text-user_session_sets">
<p>
For the purpose of <i>the application</i>, we maintain two primary state
variables.
</p>

<p>
user-set meets the requirement <a href="./requirements.html#req_user_composition">user composition</a> and session-set meets the
requirement <a href="./requirements.html#req_session_login">mandatory login</a>
</p>

<div class="org-src-container">

<pre class="src src-spec">;;; Primary state variables
 user-set    : set[User]    ; set of users in the system
 session-set : set[Session] ; set of sessions in the system
</pre>
</div>

<p>
and five relations
</p>

<div class="org-src-container">

<pre class="src src-spec">;;; Relations
 email:      User &gt; Email!
 name :      User &gt; Name!
 roles:      User &gt; Role+
 user:       Session &gt; User!
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-6-2" class="outline-3">
<h3 id="sec-6-2"><span class="section-number-3">6.2</span> Applying relations to sets</h3>
<div class="outline-text-3" id="text-6-2">
<pre class="example">
1.role = admin
2.role = user
5.role = user
{1,2,5}.role = {admin, user,user} = {admin, user}

{1,2,5}.succ = {2,3,6}
{1,2,6}.factors = {{1}, {1,2}, {1,2,3,6}}
{1,2,6}.factors.union = {{1}, {1,2}, {1,2,3,6}}.union = {1,2,3,6}
</pre>
</div>
</div>

<div id="outline-container-sec-6-3" class="outline-3">
<h3 id="sec-6-3"><span class="section-number-3">6.3</span> Derived Entity sets</h3>
<div class="outline-text-3" id="text-6-3">
<div class="org-src-container">

<pre class="src src-spec">;;; Derived Entity sets
 email-set   : set[Email]   = user-set.email        ; set of emails in the system
 name-set    : set[Name]    = user-set.name         ; set of names in the system
 role-set    : set[Role]    = user-set.role         ; set of all roles of all users
 logged-in-user-set : set[User]   = session-set.user   
 logged-in-role-set :  set[Role]  = session-set.role
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-6-4" class="outline-3">
<h3 id="sec-6-4"><span class="section-number-3">6.4</span> Referential Integrity Constraints over entity-sets</h3>
<div class="outline-text-3" id="text-6-4">
</div><div id="outline-container-admin_user" class="outline-4">
<h4 id="admin_user"><a id="sec-6-4-1" name="sec-6-4-1"></a><span class="section-number-4">6.4.1</span> Admin User</h4>
<div class="outline-text-4" id="text-admin_user">
<p>
There is at least one user with the role <code>admin</code>.
This rule meets requirement <a href="./requirements.html#req_role_admin">user with admin role</a>.
</p>
</div>
</div>

<div id="outline-container-referential_constraints" class="outline-4">
<h4 id="referential_constraints"><a id="sec-6-4-2" name="sec-6-4-2"></a><span class="section-number-4">6.4.2</span> Referential Integrity over primary and derived entity sets</h4>
<div class="outline-text-4" id="text-referential_constraints">
<p>
Meets requirements <a href="./requirements.html#req_user_uniqueness">uniqueness of a user</a>, <a href="./requirements.html#req_user_role">role of a user</a> and <a href="./requirements.html#req_session_constraints">session constraints</a>
</p>

<div class="org-src-container">

<pre class="src src-spec">;;; Relation variables with Referential Integrity
[email, user]     :  user-set!    &gt; email-set!
[name, users]     :  user-set+    &gt; name-set!    
[roles, users]    :  user-set+    &gt; role-set+
[user, sessions]  :  session-set  &gt; user-set!
[role, session]   :  session-set  &gt; role-set!
</pre>
</div>
</div>
</div>
</div>
</div>


<div id="outline-container-sec-7" class="outline-2">
<h2 id="sec-7"><span class="section-number-2">7</span> Operations</h2>
<div class="outline-text-2" id="text-7">
<p>
CRUD operations.  
</p>

<p>
Each operation is performed on an entity instance or an
entity-set.   The operation may take additional parameters.
It also takes as a  parameter of the credentials of the
actor performing the operation.
</p>

<ul class="org-ul">
<li>C  create a user      
</li>
<li>R  read from a user   
</li>
<li>U  update a user      
</li>
<li>D  delete a user      
</li>
</ul>
</div>

<div id="outline-container-sec-7-1" class="outline-3">
<h3 id="sec-7-1"><span class="section-number-3">7.1</span> Actor</h3>
<div class="outline-text-3" id="text-7-1">
<p>
Operations are performed by Actors.  Our application has two types of
actors: <code>system</code> and <code>session</code>.
</p>
</div>

<div id="outline-container-sec-7-1-1" class="outline-4">
<h4 id="sec-7-1-1"><span class="section-number-4">7.1.1</span> Authorize a user for Login</h4>
<div class="outline-text-4" id="text-7-1-1">
<p>
A user is associated with multiple roles but each login session of a user
is associated with a specific role.  The first step in the login use case
is to check if the user exists in the user set.  The second step is to
allow the user to associate a role to that particular session.
</p>
</div>

<ol class="org-ol"><li><a id="login-first-step-op" name="login-first-step-op"></a><a id="sec-7-1-1-1" name="sec-7-1-1-1"></a>Operation<br  /><div class="outline-text-5" id="text-login-first-step-op">
<p>
loginFirstStep(u:User)
</p>
</div>
</li>
<li><a id="login-first-step-auth" name="login-first-step-auth"></a><a id="sec-7-1-1-2" name="sec-7-1-1-2"></a>Actor Credentials<br  /><div class="outline-text-5" id="text-login-first-step-auth">
<p>
nothing to check
</p>
</div>
</li>
<li><a id="login-first-step-ref" name="login-first-step-ref"></a><a id="sec-7-1-1-3" name="sec-7-1-1-3"></a>Referential Integrity<br  /><div class="outline-text-5" id="text-login-first-step-ref">
<p>
u:user-set
</p>
</div>
</li>
<li><a id="login-first-step-result" name="login-first-step-result"></a><a id="sec-7-1-1-4" name="sec-7-1-1-4"></a>Result<br  /><div class="outline-text-5" id="text-login-first-step-result">
<p>
return roles of user or failure
</p>
</div>
</li></ol>
</div>


<div id="outline-container-sec-7-1-2" class="outline-4">
<h4 id="sec-7-1-2"><span class="section-number-4">7.1.2</span> Associate a role to a login session</h4>
<div class="outline-text-4" id="text-7-1-2">
<p>
The second step ensures every session in the session set is uniquely
identified by a user and a role.  This means, a user can have multiple
sessions but each session of a user is uniquely identified by a role.  In
other words a user cannot have multiple sessions with a same role.  A
session is made up of a user, a role and a key.
</p>
</div>

<ol class="org-ol"><li><a id="login-second-step-op" name="login-second-step-op"></a><a id="sec-7-1-2-1" name="sec-7-1-2-1"></a>Operation<br  /><div class="outline-text-5" id="text-login-second-step-op">
<p>
loginSecondStep(s:Session)
</p>
</div>
</li>
<li><a id="login-second-step-auth" name="login-second-step-auth"></a><a id="sec-7-1-2-2" name="sec-7-1-2-2"></a>Actor Credentials<br  /><div class="outline-text-5" id="text-login-second-step-auth">
<p>
nothing to check
</p>
</div>
</li>
<li><a id="login-second-step-ref" name="login-second-step-ref"></a><a id="sec-7-1-2-3" name="sec-7-1-2-3"></a>Referential Integrity<br  /><div class="outline-text-5" id="text-login-second-step-ref">
<p>
s:~session-set
</p>
</div>
</li>
<li><a id="login-second-step-result" name="login-second-step-result"></a><a id="sec-7-1-2-4" name="sec-7-1-2-4"></a>Result<br  /><div class="outline-text-5" id="text-login-second-step-result">
<p>
return new session or failure
</p>
</div>
</li></ol>
</div>



<div id="outline-container-sec-7-1-3" class="outline-4">
<h4 id="sec-7-1-3"><span class="section-number-4">7.1.3</span> Logout</h4>
<div class="outline-text-4" id="text-7-1-3">
<p>
Logout ensures the session is deleted from the session set.
</p>
</div>

<ol class="org-ol"><li><a id="logout-op" name="logout-op"></a><a id="sec-7-1-3-1" name="sec-7-1-3-1"></a>Operation<br  /><div class="outline-text-5" id="text-logout-op">

<p>
logout(s:Session)
</p>
</div>
</li>

<li><a id="logout-auth" name="logout-auth"></a><a id="sec-7-1-3-2" name="sec-7-1-3-2"></a>Actor Credentials<br  /><div class="outline-text-5" id="text-logout-auth">

<p>
nothing to check
</p>
</div>
</li>

<li><a id="logout-ref" name="logout-ref"></a><a id="sec-7-1-3-3" name="sec-7-1-3-3"></a>Referential Integrity<br  /><div class="outline-text-5" id="text-logout-ref">

<p>
s:session-set
</p>
</div>
</li>

<li><a id="logout-result" name="logout-result"></a><a id="sec-7-1-3-4" name="sec-7-1-3-4"></a>Result<br  /><div class="outline-text-5" id="text-logout-result">

<p>
return removed session or failure
</p>
</div>
</li></ol>
</div>


<div id="outline-container-sec-7-1-4" class="outline-4">
<h4 id="sec-7-1-4"><span class="section-number-4">7.1.4</span> Add User</h4>
<div class="outline-text-4" id="text-7-1-4">
<p>
A user is added with the default role <code>user</code>.
</p>
</div>
<ol class="org-ol"><li><a id="add-user-op" name="add-user-op"></a><a id="sec-7-1-4-1" name="sec-7-1-4-1"></a>Operation<br  /><div class="outline-text-5" id="text-add-user-op">
<p>
addUser(u:User, s:Session)
</p>
</div>
</li>
<li><a id="add-user-auth" name="add-user-auth"></a><a id="sec-7-1-4-2" name="sec-7-1-4-2"></a>Actor Credentials<br  /><div class="outline-text-5" id="text-add-user-auth">
<p>
s.role=admin
</p>
</div>
</li>
<li><a id="add-user-ref" name="add-user-ref"></a><a id="sec-7-1-4-3" name="sec-7-1-4-3"></a>Referential Integrity<br  /><div class="outline-text-5" id="text-add-user-ref">
<p>
u:~user-set AND
s:session-set  AND
u.role = user-role
</p>
</div>
</li>
<li><a id="add-user-result" name="add-user-result"></a><a id="sec-7-1-4-4" name="sec-7-1-4-4"></a>Result<br  /><div class="outline-text-5" id="text-add-user-result">
<p>
return user or failure
</p>
</div>
</li></ol>
</div>


<div id="outline-container-sec-7-1-5" class="outline-4">
<h4 id="sec-7-1-5"><span class="section-number-4">7.1.5</span> Show Users</h4>
<div class="outline-text-4" id="text-7-1-5">
<p>
The information contained for each user in the user-set that is returned is
user's name and email.
</p>
</div>

<ol class="org-ol"><li><a id="show-users-op" name="show-users-op"></a><a id="sec-7-1-5-1" name="sec-7-1-5-1"></a>Operation<br  /><div class="outline-text-5" id="text-show-users-op">

<p>
showUsers(s: Session)            
</p>
</div>
</li>

<li><a id="show-users-auth" name="show-users-auth"></a><a id="sec-7-1-5-2" name="sec-7-1-5-2"></a>Actor Credentials<br  /><div class="outline-text-5" id="text-show-users-auth">

<p>
s.role=admin OR
s.role = user
</p>
</div>
</li>

<li><a id="show-users-ref" name="show-users-ref"></a><a id="sec-7-1-5-3" name="sec-7-1-5-3"></a>Referential Integrity<br  /><div class="outline-text-5" id="text-show-users-ref">

<p>
s:session-set
</p>
</div>
</li>
<li><a id="show-users-result" name="show-users-result"></a><a id="sec-7-1-5-4" name="sec-7-1-5-4"></a>Result<br  /><div class="outline-text-5" id="text-show-users-result">
<p>
return user or failure
</p>
</div>
</li></ol>
</div>


<div id="outline-container-sec-7-1-6" class="outline-4">
<h4 id="sec-7-1-6"><span class="section-number-4">7.1.6</span> Show User Details</h4>
<div class="outline-text-4" id="text-7-1-6">
<p>
User's name, email and roles are returned when a user is identified by an
email. 
</p>
</div>

<ol class="org-ol"><li><a id="show-user-details-op" name="show-user-details-op"></a><a id="sec-7-1-6-1" name="sec-7-1-6-1"></a>Operation<br  /><div class="outline-text-5" id="text-show-user-details-op">

<p>
showUserDetails(e:Email, s: Session)
</p>
</div>
</li>

<li><a id="show-user-details-auth" name="show-user-details-auth"></a><a id="sec-7-1-6-2" name="sec-7-1-6-2"></a>Actor Credentials<br  /><div class="outline-text-5" id="text-show-user-details-auth">

<p>
s.role=admin OR                
(s.role = user AND
s.user.email = e) 
</p>
</div>
</li>

<li><a id="show-user-details-ref" name="show-user-details-ref"></a><a id="sec-7-1-6-3" name="sec-7-1-6-3"></a>Referential Integrity<br  /><div class="outline-text-5" id="text-show-user-details-ref">

<p>
s:session-set AND
e: email-set 
</p>
</div>
</li>

<li><a id="show-user-details-result" name="show-user-details-result"></a><a id="sec-7-1-6-4" name="sec-7-1-6-4"></a>Result<br  /><div class="outline-text-5" id="text-show-user-details-result">

<p>
return user or failure
</p>
</div>
</li></ol>
</div>


<div id="outline-container-sec-7-1-7" class="outline-4">
<h4 id="sec-7-1-7"><span class="section-number-4">7.1.7</span> Set Name of a User</h4>
<div class="outline-text-4" id="text-7-1-7">
<p>
Given a user and a name, the user's name is set to the given name. 
</p>
</div>

<ol class="org-ol"><li><a id="set-name-op" name="set-name-op"></a><a id="sec-7-1-7-1" name="sec-7-1-7-1"></a>Operation<br  /><div class="outline-text-5" id="text-set-name-op">

<p>
setName(u:User, n:Name, s:session)
</p>
</div>
</li>

<li><a id="set-name-auth" name="set-name-auth"></a><a id="sec-7-1-7-2" name="sec-7-1-7-2"></a>Actor Credentials<br  /><div class="outline-text-5" id="text-set-name-auth">

<p>
s.role=admin OR                
(s.role = user AND
s.user = u) 
</p>
</div>
</li>

<li><a id="set-name-ref" name="set-name-ref"></a><a id="sec-7-1-7-3" name="sec-7-1-7-3"></a>Referential Integrity<br  /><div class="outline-text-5" id="text-set-name-ref">

<p>
u:user-set AND
s:session-set 
</p>
</div>
</li>

<li><a id="set-name-result" name="set-name-result"></a><a id="sec-7-1-7-4" name="sec-7-1-7-4"></a>Result<br  /><div class="outline-text-5" id="text-set-name-result">

<p>
return user or failure
</p>
</div>
</li></ol>
</div>


<div id="outline-container-sec-7-1-8" class="outline-4">
<h4 id="sec-7-1-8"><span class="section-number-4">7.1.8</span> Set Email of a User</h4>
<div class="outline-text-4" id="text-7-1-8">
<p>
Given a user and an email, the user's email is set to the given name. 
</p>
</div>

<ol class="org-ol"><li><a id="set-email-op" name="set-email-op"></a><a id="sec-7-1-8-1" name="sec-7-1-8-1"></a>Operation<br  /><div class="outline-text-5" id="text-set-email-op">

<p>
setEmail(u:User, e:Email, s:session)
</p>
</div>
</li>

<li><a id="set-email-auth" name="set-email-auth"></a><a id="sec-7-1-8-2" name="sec-7-1-8-2"></a>Actor Credentials<br  /><div class="outline-text-5" id="text-set-email-auth">

<p>
s.role=admin OR                
(s.role = user AND
s.user = u) 
</p>
</div>
</li>

<li><a id="set-email-ref" name="set-email-ref"></a><a id="sec-7-1-8-3" name="sec-7-1-8-3"></a>Referential Integrity<br  /><div class="outline-text-5" id="text-set-email-ref">

<p>
u:user-set AND
s:session-set AND
e:~email-set
</p>
</div>
</li>

<li><a id="set-email-result" name="set-email-result"></a><a id="sec-7-1-8-4" name="sec-7-1-8-4"></a>Result<br  /><div class="outline-text-5" id="text-set-email-result">

<p>
return user or failure
</p>
</div>
</li></ol>
</div>


<div id="outline-container-sec-7-1-9" class="outline-4">
<h4 id="sec-7-1-9"><span class="section-number-4">7.1.9</span> Get User by Email</h4>
<div class="outline-text-4" id="text-7-1-9">
<p>
Return user, but the roles are masked. 
</p>
</div>

<ol class="org-ol"><li><a id="get-user-by-email-op" name="get-user-by-email-op"></a><a id="sec-7-1-9-1" name="sec-7-1-9-1"></a>Operation<br  /><div class="outline-text-5" id="text-get-user-by-email-op">

<p>
getUserByEmail(e: Email, s:Session)
</p>
</div>
</li>

<li><a id="get-user-by-email-auth" name="get-user-by-email-auth"></a><a id="sec-7-1-9-2" name="sec-7-1-9-2"></a>Actor Credentials<br  /><div class="outline-text-5" id="text-get-user-by-email-auth">

<p>
s.role = admin OR
s.role = user
</p>
</div>
</li>

<li><a id="get-user-by-email-ref" name="get-user-by-email-ref"></a><a id="sec-7-1-9-3" name="sec-7-1-9-3"></a>Referential Integrity<br  /><div class="outline-text-5" id="text-get-user-by-email-ref">

<p>
s:session-set
</p>
</div>
</li>

<li><a id="get-user-by-email-result" name="get-user-by-email-result"></a><a id="sec-7-1-9-4" name="sec-7-1-9-4"></a>Result<br  /><div class="outline-text-5" id="text-get-user-by-email-result">

<p>
return user or None or failure
</p>
</div>
</li></ol>
</div>


<div id="outline-container-sec-7-1-10" class="outline-4">
<h4 id="sec-7-1-10"><span class="section-number-4">7.1.10</span> Delete User</h4>
<div class="outline-text-4" id="text-7-1-10">
<p>
A user cannot delete self.  A user with admin role has the ability to
delete another user with admin role.
</p>
</div>

<ol class="org-ol"><li><a id="del-user-op" name="del-user-op"></a><a id="sec-7-1-10-1" name="sec-7-1-10-1"></a>Operation<br  /><div class="outline-text-5" id="text-del-user-op">

<p>
delUser(u: User, s: Session)
</p>
</div>
</li>

<li><a id="del-user-auth" name="del-user-auth"></a><a id="sec-7-1-10-2" name="sec-7-1-10-2"></a>Actor Credentials<br  /><div class="outline-text-5" id="text-del-user-auth">

<p>
s.role=admin
</p>
</div>
</li>

<li><a id="del-user-ref" name="del-user-ref"></a><a id="sec-7-1-10-3" name="sec-7-1-10-3"></a>Referential Integrity<br  /><div class="outline-text-5" id="text-del-user-ref">

<p>
u:user-set   
s:session-set
u ~= s.user  
</p>
</div>
</li>

<li><a id="del-user-result" name="del-user-result"></a><a id="sec-7-1-10-4" name="sec-7-1-10-4"></a>Result<br  /><div class="outline-text-5" id="text-del-user-result">

<p>
return deleted user or failure
</p>
</div>
</li></ol>
</div>

<div id="outline-container-sec-7-1-11" class="outline-4">
<h4 id="sec-7-1-11"><span class="section-number-4">7.1.11</span> Get Role set in the system.</h4>
<div class="outline-text-4" id="text-7-1-11">
<p>
Get all the roles in the system.
</p>
</div>

<ol class="org-ol"><li><a id="get-role-set-op" name="get-role-set-op"></a><a id="sec-7-1-11-1" name="sec-7-1-11-1"></a>Operation<br  /><div class="outline-text-5" id="text-get-role-set-op">

<p>
getRoles(s:Session)
</p>
</div>
</li>

<li><a id="get-role-set-auth" name="get-role-set-auth"></a><a id="sec-7-1-11-2" name="sec-7-1-11-2"></a>Actor Credentials<br  /><div class="outline-text-5" id="text-get-role-set-auth">

<p>
s.role = admin OR
s.role = user
</p>
</div>
</li>

<li><a id="get-role-set-ref" name="get-role-set-ref"></a><a id="sec-7-1-11-3" name="sec-7-1-11-3"></a>Referential Integrity<br  /><div class="outline-text-5" id="text-get-role-set-ref">

<p>
s:session-set
</p>
</div>
</li>

<li><a id="get-role-set-result" name="get-role-set-result"></a><a id="sec-7-1-11-4" name="sec-7-1-11-4"></a>Result<br  /><div class="outline-text-5" id="text-get-role-set-result">

<p>
return role set in the system. 
</p>
</div>
</li></ol>
</div>


<div id="outline-container-sec-7-1-12" class="outline-4">
<h4 id="sec-7-1-12"><span class="section-number-4">7.1.12</span> Get Roles of a User</h4>
<div class="outline-text-4" id="text-7-1-12">
<p>
Get all the roles of a user.
</p>
</div>

<ol class="org-ol"><li><a id="get-roles-op" name="get-roles-op"></a><a id="sec-7-1-12-1" name="sec-7-1-12-1"></a>Operation<br  /><div class="outline-text-5" id="text-get-roles-op">

<p>
getRoles(u: user, s:Session)
</p>
</div>
</li>

<li><a id="get-roles-auth" name="get-roles-auth"></a><a id="sec-7-1-12-2" name="sec-7-1-12-2"></a>Actor Credentials<br  /><div class="outline-text-5" id="text-get-roles-auth">

<p>
s.role=admin OR
(s.user = u  AND
 s.role = user)
</p>
</div>
</li>

<li><a id="get-roles-ref" name="get-roles-ref"></a><a id="sec-7-1-12-3" name="sec-7-1-12-3"></a>Referential Integrity<br  /><div class="outline-text-5" id="text-get-roles-ref">

<p>
u:user-set   
s:session-set
</p>
</div>
</li>

<li><a id="get-roles-result" name="get-roles-result"></a><a id="sec-7-1-12-4" name="sec-7-1-12-4"></a>Result<br  /><div class="outline-text-5" id="text-get-roles-result">

<p>
return roles of a user or failure
</p>
</div>
</li></ol>
</div>

<div id="outline-container-sec-7-1-13" class="outline-4">
<h4 id="sec-7-1-13"><span class="section-number-4">7.1.13</span> Add Role</h4>
<div class="outline-text-4" id="text-7-1-13">
<p>
Add a role to an existing user
</p>
</div>

<ol class="org-ol"><li><a id="add-role-op" name="add-role-op"></a><a id="sec-7-1-13-1" name="sec-7-1-13-1"></a>Operation<br  /><div class="outline-text-5" id="text-add-role-op">

<p>
addRole(u: user, s:Session, r:Role)
</p>
</div>
</li>

<li><a id="add-role-auth" name="add-role-auth"></a><a id="sec-7-1-13-2" name="sec-7-1-13-2"></a>Actor Credentials<br  /><div class="outline-text-5" id="text-add-role-auth">

<p>
s.role = admin
</p>
</div>
</li>

<li><a id="add-role-ref" name="add-role-ref"></a><a id="sec-7-1-13-3" name="sec-7-1-13-3"></a>Referential Integrity<br  /><div class="outline-text-5" id="text-add-role-ref">

<p>
u:user-set AND
s:session-set AND
r:role-set AND
r not in u.role_set
</p>
</div>
</li>

<li><a id="add-role-result" name="add-role-result"></a><a id="sec-7-1-13-4" name="sec-7-1-13-4"></a>Result<br  /><div class="outline-text-5" id="text-add-role-result">

<p>
return roles of a user or failure
</p>
</div>
</li></ol>
</div>



<div id="outline-container-sec-7-1-14" class="outline-4">
<h4 id="sec-7-1-14"><span class="section-number-4">7.1.14</span> Delete Role</h4>
<div class="outline-text-4" id="text-7-1-14">
<p>
Delete a role of an existing user
</p>
</div>

<ol class="org-ol"><li><a id="del-role-op" name="del-role-op"></a><a id="sec-7-1-14-1" name="sec-7-1-14-1"></a>Operation<br  /><div class="outline-text-5" id="text-del-role-op">

<p>
delRole(u: user, s:Session)
</p>
</div>
</li>

<li><a id="del-role-auth" name="del-role-auth"></a><a id="sec-7-1-14-2" name="sec-7-1-14-2"></a>Actor Credentials<br  /><div class="outline-text-5" id="text-del-role-auth">

<p>
s.role = admin
</p>
</div>
</li>

<li><a id="del-role-ref" name="del-role-ref"></a><a id="sec-7-1-14-3" name="sec-7-1-14-3"></a>Referential Integrity<br  /><div class="outline-text-5" id="text-del-role-ref">

<p>
u:user-set AND
s:session-set AND
u ~= s.user  AND
r:role-set AND
r in u.role_set AND
u.num_roles &gt; 1
</p>

<p>
Since only user with admin role can delete roles of other users and not of
self,  this rule ensures that there is always a user with admin role. 
</p>
</div>
</li>

<li><a id="del-role-result" name="del-role-result"></a><a id="sec-7-1-14-4" name="sec-7-1-14-4"></a>Result<br  /><div class="outline-text-5" id="text-del-role-result">

<p>
return roles of a user or failure
</p>
</div>
</li></ol>
</div>



<div id="outline-container-sec-7-1-15" class="outline-4">
<h4 id="sec-7-1-15"><span class="section-number-4">7.1.15</span> Show Sessions</h4>
<div class="outline-text-4" id="text-7-1-15">
<p>
Return the session set
</p>
</div>

<ol class="org-ol"><li><a id="show-sessions-op" name="show-sessions-op"></a><a id="sec-7-1-15-1" name="sec-7-1-15-1"></a>Operation<br  /><div class="outline-text-5" id="text-show-sessions-op">

<p>
showSessions(s:Session)
</p>
</div>
</li>

<li><a id="show-sessions-auth" name="show-sessions-auth"></a><a id="sec-7-1-15-2" name="sec-7-1-15-2"></a>Actor Credentials<br  /><div class="outline-text-5" id="text-show-sessions-auth">

<p>
s.role = admin
</p>
</div>
</li>

<li><a id="show-sessions-ref" name="show-sessions-ref"></a><a id="sec-7-1-15-3" name="sec-7-1-15-3"></a>Referential Integrity<br  /><div class="outline-text-5" id="text-show-sessions-ref">

<p>
s:session-set
</p>
</div>
</li>

<li><a id="show-sessions-result" name="show-sessions-result"></a><a id="sec-7-1-15-4" name="sec-7-1-15-4"></a>Result<br  /><div class="outline-text-5" id="text-show-sessions-result">

<p>
return session set or failure
</p>
</div>
</li></ol>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Date: <span class="timestamp-wrapper"><span class="timestamp">[2016-05-11 Wed]</span></span></p>
<p class="author">Author: VLEAD</p>
<p class="date">Created: 2020-12-12 Sat 19:19</p>
<p class="creator"><a href="http://www.gnu.org/software/emacs/">Emacs</a> 25.2.2 (<a href="http://orgmode.org">Org</a> mode 8.2.10)</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
